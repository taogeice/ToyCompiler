# ToyCompiler

一个用C语言实现的现代C语言编译器项目，支持C11/C17标准，具备完整的编译器前端、中端和后端功能。

## 项目概述

ToyCompiler是一个教育性质的C语言编译器项目，旨在展示现代编译器的设计和实现原理。项目采用纯C语言实现，遵循模块化设计原则，支持完整的编译流程。

### 主要特性

- **完整的编译器架构**: 包含词法分析、语法分析、语义分析、中间代码生成、优化和代码生成
- **C11/C17标准支持**: 支持现代C语言特性，包括原子操作、泛型选择等
- **模块化设计**: 清晰的模块分离，便于维护和扩展
- **跨平台支持**: 支持多种目标平台（x86、ARM等）
- **丰富的错误诊断**: 提供详细的错误信息和错误恢复机制
- **可扩展的优化框架**: 支持插件化的优化Pass系统
- **完整的调试信息生成**: 支持DWARF调试信息格式

## 技术实现

### 实现语言
- **主要语言**: 纯C语言（C99/C11标准）
- **构建系统**: CMake
- **测试框架**: 自定义C语言测试框架
- **文档系统**: Markdown + Doxygen

### 核心数据结构
- **结构体和函数指针**: 使用C语言的结构体和函数指针实现面向对象特性
- **自定义数据结构**: 实现向量、哈希表、树等数据结构
- **手动内存管理**: 使用内存池和引用计数管理内存
- **错误码机制**: 使用枚举和错误码处理异常情况
- **void*和类型标识符**: 实现泛型编程特性

## 项目结构

```
ToyCompiler/
├── src/                    # 源代码目录
│   ├── frontend/           # 前端模块
│   │   ├── lexer/         # 词法分析器
│   │   ├── parser/        # 语法分析器
│   │   ├── ast/           # 抽象语法树
│   │   └── semanticanalyzer/ # 语义分析器
│   ├── midend/            # 中端模块
│   │   ├── ir/            # 中间表示
│   │   └── optimizer/     # 优化器
│   ├── backend/           # 后端模块
│   │   ├── codegen/       # 代码生成器
│   │   └── registeralloc/ # 寄存器分配
│   ├── common/            # 公共组件
│   │   ├── utils/         # 工具函数
│   │   ├── containers/    # 数据结构
│   │   └── diagnostics/   # 诊断系统
│   ├── type/              # 类型系统
│   ├── symbol/            # 符号表
│   └── driver/            # 编译器驱动
├── doc/                   # 文档目录
├── test/                  # 测试目录
├── tools/                 # 工具目录
├── examples/              # 示例代码
└── CMakeLists.txt         # 构建配置
```

## 编译流程

1. **词法分析**: 将源代码字符流转换为token流
2. **语法分析**: 根据语法规则构建抽象语法树
3. **语义分析**: 进行类型检查、作用域分析等
4. **IR生成**: 将AST转换为中间表示
5. **优化**: 对IR进行各种优化
6. **代码生成**: 将优化后的IR转换为目标代码

## 快速开始

### 构建项目

```bash
mkdir build
cd build
cmake ..
make
```

### 编译C程序

```bash
./bin/tcc input.c -o output
```

### 运行测试

```bash
make test
```

## 文档

- [架构设计文档](doc/modern_c_compiler_architecture.md)
- [项目结构指南](doc/project_structure_guide.md)
- [架构验证报告](doc/architecture_validation.md)

## 贡献指南

欢迎提交Issue和Pull Request来改进项目。请确保：

1. 遵循C语言编码规范
2. 添加适当的测试用例
3. 更新相关文档
4. 通过所有现有测试

## 许可证

本项目采用MIT许可证，详见LICENSE文件。

## 联系方式

如有问题或建议，请通过以下方式联系：

- 提交GitHub Issue
- 发送邮件至项目维护者

---

**注意**: 这是一个教育性质的编译器项目，主要用于学习和研究目的。在生产环境中使用前请进行充分测试。
